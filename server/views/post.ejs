<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Hub</title>
    <link rel="stylesheet" href="/css/post.css">
    <!-- Firebase SDK (non-module version) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyA3_Otys41HjaAnDG8f2jFuzzuUJTiF-Po",
            authDomain: "store-work-10c7d.firebaseapp.com",
            projectId: "store-work-10c7d",
            storageBucket: "store-work-10c7d.firebasestorage.app",
            messagingSenderId: "364380068504",
            appId: "1:364380068504:web:fe303c05a95bb777b6ceed",
            measurementId: "G-DSG9XHW38R",
        };
        firebase.initializeApp(firebaseConfig);
    </script>
</head>

<body>
    <div class="container">
        <header class="header">
            <h1>Knowledge Hub</h1>
            <button id="theme-toggle"><i class="ri-moon-line"></i></button>
        </header>

        <aside class="sidebar">
            <a href="/post/u/<%= id %>"><i class="ri-home-line"></i> Home</a>
            <a href="/make/u/<%= id %>"><i class="ri-user-add-line"></i> Create characters</a>
            <a href="#" id="logout-btn"><i class="ri-logout-box-line"></i> Log Out</a>
        </aside>

        <main>
            <section class="profile-card">
                <div class="profile-img-container" id="profile-img-container">
                    <img id="profile-img" src="<%= user.photo || '/default-avatar.png' %>" alt="Profile Image">
                    <input type="file" id="profile-image-input" accept="image/jpeg,image/jpg,image/png,image/gif">
                </div>
                <div class="profile-info">
                    <h2>
                        <%= user.name %>
                    </h2>
                    <p>Bio: <%= user.bio || 'Not set' %>
                    </p>
                    <p>Status: <span class="status-indicator <%= user.status === 'Online' ? 'online' : '' %>"></span>
                        <%= user.status || 'Offline' %>
                    </p>
                </div>
            </section>

            <section class="create-post">
                <h2>Create a New Post</h2>
                <div id="editor" class="quill-editor"></div>
                <div class="post-options">
                    <select id="community-select">
                        <option value="General">General</option>
                        <option value="Space">Space</option>
                        <option value="Coding">Coding</option>
                        <option value="Linux">Linux</option>
                        <option value="Cybersecurity">Cybersecurity</option>
                        <option value="Characters">Characters</option>
                    </select>
                    <button id="post-btn">Post</button>
                </div>
            </section>

            <section class="posts">
                <h2>Explore Posts</h2>
                <div id="posts-container">
                    <% posts.forEach(post=> { %>
                        <div class="post-card">
                            <div class="post-header">
                                <img src="<%= post.authorPhoto || '/default-avatar.png' %>" alt="Author">
                                <div>
                                    <h3>
                                        <%= post.authorName %>
                                    </h3>
                                    <p class="text-sm">
                                        <%= new Date(post.createdAt).toLocaleString() %>
                                    </p>
                                    <p class="text-sm">
                                        <%= post.community %>
                                    </p>
                                </div>
                            </div>
                            <div class="post-content">
                                <%= post.content %>
                            </div>
                            <div class="post-actions">
                                <button class="like-btn" data-id="<%= post._id %>"
                                    data-liked="<%= post.likedBy.includes(id) %>">
                                    <i class="ri-heart-line <%= post.likedBy.includes(id) ? 'liked' : '' %>"></i>
                                    <%= post.likeCount %>
                                </button>
                                <button class="comment-btn" data-id="<%= post._id %>"><i class="ri-chat-3-line"></i>
                                    <%= post.commentCount %>
                                </button>
                            </div>
                            <div class="comments" id="comments-<%= post._id %>">
                                <% if (comments[post._id]) { %>
                                    <% comments[post._id].forEach(comment=> { %>
                                        <div class="comment">
                                            <div class="comment-header">
                                                <img src="<%= comment.authorPhoto || '/default-avatar.png' %>"
                                                    alt="Author" style="width: 30px; height: 30px; border-radius: 50%;">
                                                <div>
                                                    <h4>
                                                        <%= comment.authorName %>
                                                    </h4>
                                                    <p class="text-xs">
                                                        <%= new Date(comment.createdAt).toLocaleString() %>
                                                    </p>
                                                </div>
                                            </div>
                                            <p>
                                                <%= comment.content %>
                                            </p>
                                            <div class="comment-actions">
                                                <button class="like-btn" data-id="<%= comment._id %>"
                                                    data-type="comment"
                                                    data-liked="<%= comment.likedBy.includes(id) %>">
                                                    <i
                                                        class="ri-heart-line <%= comment.likedBy.includes(id) ? 'liked' : '' %>"></i>
                                                    <%= comment.likes %>
                                                </button>
                                            </div>
                                        </div>
                                        <% }); %>
                                            <% } %>
                            </div>
                        </div>
                        <% }); %>
                </div>
            </section>
        </main>
    </div>

    <div id="toast" style="display: none;"></div>

    <script src="https://www.unpkg.com/quill@1.3.7/dist/quill.js"></script>
    <script src="/js/post.js"></script>
</body>

</html>

                                                 